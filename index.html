<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C…ôdv…ôl</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#0f172a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="758/ITS">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        darkBg: '#0f172a',
                        darkCard: '#1e293b'
                    },
                    fontFamily: {
                        sans: ['Averta', 'Montserrat', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <script>
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
        function toggleDarkMode() {
            if (document.documentElement.classList.contains('dark')) {
                document.documentElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                document.documentElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        }
    </script>
    <style>
        @font-face {
            font-family: 'Averta';
            src: local('Montserrat'), local('sans-serif');
        }

        body {
            font-family: 'Averta', 'Montserrat', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        * {
            transition-property: background-color, border-color, color, fill, stroke;
            transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
            transition-duration: 300ms;
        }

        @keyframes pulse-custom {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .btn-pulse {
            animation: pulse-custom 2s infinite;
        }
    </style>
</head>

<body
    class="bg-slate-100 dark:bg-darkBg text-slate-800 dark:text-white antialiased font-sans transition-colors duration-300">

    <header
        class="sticky top-0 z-50 backdrop-blur-lg bg-white/80 dark:bg-darkBg/80 border-b border-slate-200 dark:border-slate-800 text-slate-900 dark:text-white font-extrabold p-4 text-2xl flex justify-between items-center shadow-sm">
        <span>758/ITS</span>
        <button onclick="toggleDarkMode()" id="theme-toggle" title="M√∂vzunu d…ôyi≈üdir"
            class="relative w-12 h-12 flex items-center justify-center rounded-full bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-yellow-400 hover:bg-slate-200 dark:hover:bg-slate-700 active:scale-95 transition-all overflow-hidden focus:outline-none">
            <svg id="theme-toggle-light"
                class="absolute w-6 h-6 transition-all duration-500 origin-center dark:-rotate-90 dark:opacity-0"
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z">
                </path>
            </svg>
            <svg id="theme-toggle-dark"
                class="absolute w-6 h-6 transition-all duration-500 origin-center rotate-90 opacity-0 dark:rotate-0 dark:opacity-100"
                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
            </svg>
        </button>
    </header>

    <nav class="flex flex-wrap justify-center items-center gap-3 my-6 px-4">
        <button onclick="showSection('kurs2Section')"
            class="whitespace-nowrap bg-blue-600 text-white font-bold py-2.5 px-6 rounded-2xl shadow-lg shadow-blue-500/30 transition transform hover:scale-105 active:scale-95">2-ci
            KURS</button>
        <button onclick="window.location.href='https://kenox7.github.io/herkes/'"
            class="whitespace-nowrap bg-white dark:bg-darkCard text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-800 font-semibold py-2.5 px-6 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-sm">Qayƒ±blar</button>
        <button onclick="showSection('kurs1Section')"
            class="whitespace-nowrap bg-white dark:bg-darkCard text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-800 font-semibold py-2.5 px-6 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-sm">1-ci
            kurs</button>
        <button onclick="showSection('pdfsSection')"
            class="whitespace-nowrap bg-white dark:bg-darkCard text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-800 font-semibold py-2.5 px-6 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-sm">PDF</button>
        <button onclick="showSection('flappySection')"
            class="whitespace-nowrap bg-white dark:bg-darkCard text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-800 font-semibold py-2.5 px-6 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-sm">Flappy
            Ramin</button>
        <button onclick="showSection('bagikSection')"
            class="whitespace-nowrap bg-white dark:bg-darkCard text-slate-700 dark:text-slate-300 border border-slate-200 dark:border-slate-800 font-semibold py-2.5 px-6 rounded-2xl transition transform hover:scale-105 active:scale-95 shadow-sm">Bagik
            Run</button>
    </nav>

    <main class="container mx-auto px-4">
        <div id="loader" class="text-center py-10 hidden">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"></div>
            <p class="mt-2 text-slate-500 dark:text-gray-400">C…ôdv…ôl y√ºkl…ônir...</p>
        </div>

        <div id="kurs2Section" class="content hidden">
            <h1
                class="text-4xl font-extrabold mb-2 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-500">
                2-ci KURS C∆èDV∆èLƒ∞</h1>

            <div class="flex flex-col items-center justify-center gap-3 mb-6">
                <h3 id="weekType" class="text-2xl text-yellow-400 font-bold drop-shadow-md text-center"></h3>

                <div id="pwa-install-container" class="hidden mt-3 mb-3">
                    <button id="pwa-install-btn"
                        class="btn-pulse bg-gradient-to-r from-green-600 to-teal-500 hover:from-green-700 hover:to-teal-600 text-white font-bold py-2 px-6 rounded-full shadow-lg transition transform hover:scale-105 flex items-center gap-2 border border-green-400/50">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                                clip-rule="evenodd" />
                        </svg>
                        T…ôtbiqi Y√ºkl…ô
                    </button>
                </div>

                <div
                    class="flex items-center gap-4 bg-white dark:bg-darkCard p-2 rounded-full shadow-sm border border-slate-100 dark:border-slate-800">
                    <button onclick="changeWeek(-1)"
                        class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-blue-400 transition hover:scale-110 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                        </svg>
                    </button>
                    <span id="dateRange"
                        class="text-slate-700 dark:text-slate-300 font-mono font-semibold min-w-[140px] text-center"></span>
                    <button onclick="changeWeek(1)"
                        class="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-blue-400 transition hover:scale-110 active:scale-95">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                    </button>
                </div>
                <button onclick="resetToToday()"
                    class="text-xs text-slate-500 dark:text-slate-400 hover:text-blue-500 dark:hover:text-blue-400 underline decoration-dotted">Bug√ºn…ô
                    qayƒ±t</button>
            </div>

            <div id="schedule_kurs2" class="max-w-2xl mx-auto space-y-4 px-2"></div>

            <div id="commentsSection" class="max-w-3xl mx-auto mt-12 pt-6 border-t border-gray-700">
                <h2 class="text-3xl font-bold mb-6 text-center text-blue-300">Qeydl…ôr</h2>
                <form id="comment-form" class="flex flex-col md:flex-row gap-4 mb-6">
                    <input type="text" id="name-input" placeholder="Adƒ±n..." required
                        class="flex-grow bg-slate-100 border border-slate-200 dark:border-slate-700 dark:bg-slate-800 rounded-2xl p-4 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-inner" />
                    <input type="text" id="comment-input" placeholder="Fikrini yaz..." required
                        class="flex-grow bg-slate-100 border border-slate-200 dark:border-slate-700 dark:bg-slate-800 rounded-2xl p-4 text-slate-800 dark:text-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all shadow-inner" />
                    <button type="submit"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-2xl shadow-lg shadow-blue-500/30 active:scale-95 transition-colors">G√∂nd…ôr</button>
                </form>
                <div id="comments-list"></div>
            </div>
        </div>

        <div id="kurs1Section" class="content hidden">
            <h1
                class="text-4xl font-extrabold mb-6 text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-500">
                1-ci KURS C∆èDV∆èLƒ∞</h1>
            <div id="schedule_kurs1" class="max-w-2xl mx-auto space-y-4 px-2"></div>
        </div>

        <div id="pdfsSection" class="content hidden">
            <div class="grid md:grid-cols-2 gap-6 max-w-5xl mx-auto">
                <div
                    class="bg-white dark:bg-darkCard rounded-3xl shadow-sm p-6 border border-slate-100 dark:border-slate-800">
                    <h3 class="text-xl font-bold mb-3 text-blue-300">English for Information Technology 1</h3>
                    <iframe id="pdf1" class="w-full h-96 rounded-md border-2 border-gray-600" loading="lazy"></iframe>
                    <div class="mt-4 flex gap-2">
                        <a id="pdf1-download" target="_blank"
                            class="w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full transition-colors">Y√ºkl…ô</a>
                    </div>
                </div>
                <div
                    class="bg-white dark:bg-darkCard rounded-3xl shadow-sm p-6 border border-slate-100 dark:border-slate-800">
                    <h3 class="text-xl font-bold mb-3 text-blue-300">Murphy (qƒ±rmƒ±zƒ± kitab)</h3>
                    <iframe id="pdf2" class="w-full h-96 rounded-md border-2 border-gray-600" loading="lazy"></iframe>
                    <div class="mt-4 flex gap-2">
                        <a id="pdf2-download" target="_blank"
                            class="w-full text-center bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-full transition-colors">Y√ºkl…ô</a>
                    </div>
                </div>
            </div>
        </div>

        <div id="flappySection" class="content hidden">
            <h1
                class="text-4xl font-extrabold mb-6 text-center text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                Flappy Ramin</h1>
            <div id="flappyContainer"
                class="aspect-video max-w-4xl mx-auto bg-white dark:bg-darkCard rounded-3xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-800">
            </div>
        </div>

        <div id="bagikSection" class="content hidden">
            <h1
                class="text-4xl font-extrabold mb-6 text-center text-center text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                Bagik Run</h1>
            <div id="bagikContainer"
                class="aspect-video max-w-4xl mx-auto bg-white dark:bg-darkCard rounded-3xl shadow-sm overflow-hidden border border-slate-100 dark:border-slate-800">
            </div>
        </div>

        <div id="comments_container"></div>
        </div>
    </main>

    <footer class="text-center p-8 mt-10 text-slate-500 dark:text-gray-400">
        <p>@by Kenan</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        import { SystemManager } from "./firestore_manager.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAtQ_laoPhn_31RgUFp5hkHPzAcYJSH9_8",
            authDomain: "davamiyyet-sistemi.firebaseapp.com",
            databaseURL: "https://yorumlar-8f969-default-rtdb.firebaseio.com/",
            projectId: "davamiyyet-sistemi",
            storageBucket: "davamiyyet-sistemi.appspot.com",
            messagingSenderId: "773549402059",
            appId: "1:773549402059:web:25286906aa1d998041f84e",
            measurementId: "G-M3Y8QZCM8C"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const rtdb = getDatabase(app);
        const manager = new SystemManager(db);
        const currentGroupId = "758_ITS";
        let currentSchedule = null;
        let viewOffset = 0;

        // --- SAAT ZONASI D√úZ∆èLƒ∞≈ûƒ∞ (UTC+4 Sabit) ---
        function getBakuDate() {
            const d = new Date();
            // Cihazƒ±n UTC vaxtƒ±nƒ± tapƒ±rƒ±q
            const utc = d.getTime() + (d.getTimezoneOffset() * 60000);
            // √úz…ôrin…ô 4 saat g…ôlirik (Bakƒ±)
            return new Date(utc + (3600000 * 4));
        }

        const commentsRef = ref(rtdb, "comments");
        let clientId = localStorage.getItem('clientId');
        if (!clientId) {
            clientId = 'client-' + Math.random().toString(36).substring(2, 11);
            localStorage.setItem('clientId', clientId);
        }

        const commentForm = document.getElementById("comment-form");
        if (commentForm) {
            commentForm.addEventListener("submit", (e) => {
                e.preventDefault();
                const nameInput = document.getElementById("name-input");
                const commentInput = document.getElementById("comment-input");

                if (nameInput.value.trim() !== "" && commentInput.value.trim() !== "") {
                    push(commentsRef, {
                        name: nameInput.value,
                        text: commentInput.value,
                        timestamp: Date.now(),
                        clientId: clientId
                    });
                    nameInput.value = "";
                    commentInput.value = "";
                }
            });
        }

        onValue(commentsRef, (snapshot) => {
            const commentsList = document.getElementById("comments-list");
            if (!commentsList) return;

            commentsList.innerHTML = "";
            const commentsArray = [];
            snapshot.forEach((childSnapshot) => {
                commentsArray.push(childSnapshot.val());
            });

            commentsArray.sort((a, b) => b.timestamp - a.timestamp).forEach((data) => {
                const commentDiv = document.createElement("div");
                commentDiv.className = "bg-white dark:bg-darkCard p-5 rounded-3xl mb-4 border border-slate-100 dark:border-slate-800 shadow-sm";
                const date = new Date(data.timestamp);
                // Komment vaxtƒ±nƒ± g√∂st…ôr…ôrk…ôn d…ô getBakuDate m…ôntiqin…ô uyƒüunla≈üdƒ±ra bil…ôrik, amma toLocaleString burda OK-dir
                const formattedDate = date.toLocaleString("az-AZ", { dateStyle: 'medium', timeStyle: 'short' });
                commentDiv.innerHTML = `
            <p class="text-slate-800 dark:text-slate-200"><strong class="text-blue-300">${data.name}:</strong> ${data.text}</p>
            <small class="text-slate-400 dark:text-slate-500">${formattedDate}</small>
            `;
                commentsList.appendChild(commentDiv);
            });
        });

        async function init() {
            const loader = document.getElementById('loader');
            if (loader) loader.classList.remove('hidden');

            // 1. D…ôrhal LocalStorage-dan y√ºkl…ôm…ôy…ô √ßalƒ±≈üƒ±rƒ±q (Offline v…ô s√ºr…ôtli a√ßmaq √º√ß√ºn)
            const cachedScheduleStr = localStorage.getItem(`schedule_${currentGroupId}`);
            const cachedSemesterStr = localStorage.getItem('activeSemester');

            if (cachedSemesterStr && cachedScheduleStr) {
                try {
                    const cachedSemester = JSON.parse(cachedSemesterStr);
                    currentSchedule = JSON.parse(cachedScheduleStr);
                    renderScheduleKurs2();
                    // ∆èg…ôr cache varsa, loaderi baƒülayaq, ancaq arxada yenil…ônm…ô davam etsin
                    if (loader) loader.classList.add('hidden');
                    const section = document.getElementById('kurs2Section');
                    if (section) section.classList.remove('hidden');
                } catch (e) {
                    console.error("Cache parsing error", e);
                }
            }

            // 2. Arxa planda Firebase-d…ôn yeni m…ôlumatlarƒ± yoxlayƒ±b yenil…ôyirik
            try {
                const semester = await manager.getActiveSemester();
                if (semester) {
                    const newSchedule = await manager.getGroupSchedule(semester.id, currentGroupId);

                    // F…ôrq varsa yenil…ôyib ekrana veririk
                    if (JSON.stringify(newSchedule) !== cachedScheduleStr || JSON.stringify(semester) !== cachedSemesterStr) {
                        currentSchedule = newSchedule;
                        localStorage.setItem('activeSemester', JSON.stringify(semester));
                        localStorage.setItem(`schedule_${currentGroupId}`, JSON.stringify(newSchedule));
                        // Yalnƒ±z …ôg…ôr cache bo≈ü idis…ô v…ô ya f…ôrq varsa yenid…ôn render ed…ôk
                        renderScheduleKurs2();
                    }
                } else {
                    const el = document.getElementById('schedule_kurs2');
                    if (el) el.innerHTML = "<p class='text-center text-slate-500 dark:text-gray-400'>Aktiv Semestr Yoxdur.</p>";
                    localStorage.removeItem('activeSemester');
                    localStorage.removeItem(`schedule_${currentGroupId}`);
                }
            } catch (e) {
                console.error("Firebase fetch error (Offline ola bil…ôr):", e);
                // ∆èg…ôr offset 0-dƒ±rsa internet x…ôtasƒ± ver…ô bil…ôrik, amma cache il…ô i≈ül…ôyirs…ô s…ôssiz qalƒ±r.
            } finally {
                if (loader) loader.classList.add('hidden');
                const section = document.getElementById('kurs2Section');
                if (section) section.classList.remove('hidden');
            }

            // H…ôft…ôsonu (≈û…ônb…ô v…ô ya Bazar) is…ô avtomatik g…ôl…ôn h…ôft…ôni g√∂st…ôr
            const today = getBakuDate();
            if (today.getDay() === 0 || today.getDay() === 6) {
                if (viewOffset === 0) {
                    viewOffset = 1;
                    renderScheduleKurs2();
                }
            }
        }

        const startDate = new Date("2026-02-16T00:00:00+04:00");

        function startOfDayCopy(d) {
            const c = new Date(d);
            c.setHours(0, 0, 0, 0);
            return c;
        }

        function hefteniTap(date) {
            const ref = startOfDayCopy(startDate);
            const d = startOfDayCopy(date);
            const diffMs = d.getTime() - ref.getTime();
            const diffWeeks = Math.floor(diffMs / (1000 * 60 * 60 * 24 * 7)) + 1;
            const type = (diffWeeks % 2 === 0) ? "alt" : "ust";
            return { type, number: diffWeeks > 0 ? diffWeeks : 1 };
        }

        function tarihFormatla(date) {
            const gunler = ["Bazar", "1-ci G√ºn<br> Bazar ert…ôsi", "2-ci G√ºn<br> √á…ôr≈ü…ônb…ô ax≈üamƒ±", "3-c√º G√ºn<br> √á…ôr≈ü…ônb…ô", "4-c√º G√ºn<br> C√ºm…ô ax≈üamƒ±", "5-ci G√ºn<br> C√ºm…ô", "≈û…ônb…ô"];
            return `${gunler[date.getDay()]}, ${date.toLocaleDateString('az-AZ')}`;
        }

        const lessonSlots = [
            { start: "09:00", end: "10:20" },
            { start: "10:30", end: "11:50" },
            { start: "12:10", end: "13:30" },
            { start: "13:40", end: "15:00" },
            { start: "15:10", end: "16:30" }
        ];

        function isLessonActive(slotIndex) {
            if (slotIndex < 1 || slotIndex > 5) return false;

            const now = getBakuDate();
            const slot = lessonSlots[slotIndex - 1];

            const [sH, sM] = slot.start.split(':');
            const [eH, eM] = slot.end.split(':');

            const startTime = getBakuDate();
            startTime.setHours(parseInt(sH), parseInt(sM), 0, 0);

            const endTime = getBakuDate();
            endTime.setHours(parseInt(eH), parseInt(eM), 0, 0);

            return now >= startTime && now <= endTime;
        }

        window.changeWeek = (delta) => {
            viewOffset += delta;
            renderScheduleKurs2();
        };

        window.resetToToday = () => {
            viewOffset = 0;
            renderScheduleKurs2();
        };

        window.copyDaySchedule = (dateStr, lessonsArr) => {
            if (!lessonsArr || lessonsArr.length === 0) return;
            const textLines = lessonsArr.map(l => {
                let clean = l;
                if (l.startsWith('{')) clean = l.substring(l.indexOf('}') + 1).trim();
                return `‚Ä¢ ${clean}`;
            }).join('\n');

            const header = `üìÖ *${dateStr}* d…ôrsl…ôri:\n`;
            const footer = `\n____________________\n758/ITS C…ôdv…ôl`;

            const fullText = header + textLines + footer;

            navigator.clipboard.writeText(fullText).then(() => {
                alert("C…ôdv…ôl kopyalandƒ±! WhatsApp-da payla≈üa bil…ôrsiniz.");
            }).catch(err => {
                console.error("Copy failed", err);
            });
        };

        function renderScheduleKurs2() {
            let container = document.getElementById("schedule_kurs2");
            if (!container) return;

            container.innerHTML = "";

            const today = getBakuDate();
            const viewDate = getBakuDate();
            viewDate.setDate(today.getDate() + (viewOffset * 7));

            const dayOfWeek = viewDate.getDay();
            const diffToMon = (dayOfWeek + 6) % 7;
            const mondayDate = new Date(viewDate);
            mondayDate.setDate(viewDate.getDate() - diffToMon);

            const weekInfo = hefteniTap(mondayDate);
            const weekType = weekInfo.type;

            const wtEl = document.getElementById("weekType");
            if (wtEl) wtEl.innerHTML = `
                <div class="flex flex-col items-center">
                    <span class="text-3xl font-bold ${weekType === 'alt' ? 'text-yellow-400' : 'text-green-400'} uppercase drop-shadow-sm">${weekType === 'alt' ? 'ALT H∆èFT∆è' : '√úST H∆èFT∆è'}</span>
                    <span class="text-sm text-slate-500 dark:text-gray-400 font-mono tracking-widest mt-1">SEMESTRƒ∞N ${weekInfo.number}-Cƒ∞ H∆èFT∆èSƒ∞</span>
                </div>
            `;

            const sunDate = new Date(mondayDate);
            sunDate.setDate(mondayDate.getDate() + 6);

            const azMonths = ["Yan", "Fev", "Mar", "Apr", "May", "ƒ∞yun", "ƒ∞yul", "Avq", "Sen", "Okt", "Noy", "Dek"];
            const startStr = `${mondayDate.getDate()} ${azMonths[mondayDate.getMonth()]}`;
            const endStr = `${sunDate.getDate()} ${azMonths[sunDate.getMonth()]}`;

            document.getElementById("dateRange").innerText = `${startStr} - ${endStr}`;

            for (let i = 0; i < 7; i++) {
                const date = new Date(mondayDate);
                date.setDate(mondayDate.getDate() + i);
                const loopDayIndex = date.getDay();

                if (loopDayIndex >= 1 && loopDayIndex <= 5) {
                    const loopWeekInfo = hefteniTap(date);
                    const loopWeekType = loopWeekInfo.type;
                    const lessons = currentSchedule && currentSchedule[loopWeekType] ? currentSchedule[loopWeekType][loopDayIndex] : [];

                    const isTodayReal = (date.toDateString() === today.toDateString());

                    const lessonHtml = (lessons && lessons.length > 0)
                        ? lessons.sort().map((l) => {
                            let display = l;
                            let slotNum = null;

                            if (l.startsWith('{')) {
                                const endIdx = l.indexOf('}');
                                slotNum = parseInt(l.substring(1, endIdx));
                                display = l.substring(endIdx + 1).trim();
                            }

                            const hasLegacyNumbering = /^\d+\)/.test(display);
                            let numberPrefix = "";
                            // Vƒ∞ZUAL: Slot n√∂mr…ôsini 1, 2, 3 kimi g√∂st…ôrm…ôk √º√ß√ºn
                            let mappedNum = slotNum;
                            if (!hasLegacyNumbering && slotNum) {
                                mappedNum = (slotNum > 3) ? (slotNum - 3) : slotNum;
                                numberPrefix = `<span class="text-blue-400 font-bold mr-2 text-lg">${mappedNum}</span>`;
                            } else if (hasLegacyNumbering) {
                                const parts = display.match(/^(\d+\))(.*)/);
                                if (parts) {
                                    numberPrefix = `<span class="text-blue-400 font-bold mr-2 text-lg">${parts[1].replace(')', '')}</span>`;
                                    display = parts[2];
                                }
                            }

                            let typeBadge = "";
                            if (display.toLowerCase().includes("m√ºhazir…ô")) {
                                typeBadge = `<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 dark:bg-purple-500/10 text-purple-600 dark:text-purple-400 border border-purple-200 dark:border-purple-500/20 uppercase tracking-wider ml-2">M√ºhazir…ô</span>`;
                                display = display.replace(/\(m√ºhazir…ô\)/i, '').trim();
                            } else if (display.toLowerCase().includes("seminar")) {
                                typeBadge = `<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-200 dark:border-orange-500/20 uppercase tracking-wider ml-2">Seminar</span>`;
                                display = display.replace(/\(seminar\)/i, '').trim();
                            }

                            let content = display;
                            if (display.includes(' - ')) {
                                const parts = display.split(' - ');
                                const subj = parts[0].trim();
                                const teach = parts.slice(1).join(' - ').trim();
                                content = `<span class="text-slate-900 dark:text-white font-bold text-base">${subj}</span>${typeBadge}<span class="block text-sm text-slate-500 dark:text-gray-400 mt-1 flex items-center gap-2"><div class="p-1 rounded-full bg-slate-200 dark:bg-slate-700"><svg class="w-3 h-3 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <span class="text-slate-600 dark:text-slate-400 font-medium">${teach}</span></span>`;
                            } else {
                                content = `<span>${display}</span>${typeBadge}`;
                            }

                            return `<div class="relative p-3 rounded-2xl mt-3 text-sm flex items-start transition-all duration-300 overflow-hidden bg-slate-50 border border-slate-100 dark:border-none dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700/50">
                                            <div class="mt-0.5">${numberPrefix}</div>
                                            <div class="absolute left-0 top-3 bottom-3 w-1.5 bg-blue-500 rounded-r-lg"></div>
                                            <div class="w-full pl-4 py-1">${content}</div>
                                        </div>`;
                        }).join('')
                        : "<div class='mt-4 text-center py-6 bg-white dark:bg-darkCard rounded-3xl border border-dashed border-slate-300 dark:border-slate-700 shadow-sm'><p class='text-slate-400 dark:text-slate-500 italic text-sm'>Bu g√ºn d…ôrsl…ôr yoxdur, istirah…ôt vaxtƒ±dƒ±r! üéÆ</p></div>";

                    const dateStr = tarihFormatla(date).replace('<br>', '');
                    const lessonsData = JSON.stringify(lessons).replace(/"/g, '&quot;');

                    container.innerHTML += `
                        <div class='relative group overflow-hidden transition-all duration-300 ${isTodayReal ? 'bg-white dark:bg-darkCard border border-blue-200 dark:border-slate-800 shadow-lg shadow-blue-500/10 transform scale-[1.02] ring-2 ring-blue-500 ring-offset-2 ring-offset-slate-100 dark:ring-offset-darkBg rounded-3xl' : 'bg-white dark:bg-darkCard border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md rounded-3xl'}'>
                            
                            <div class="p-4 ${isTodayReal ? 'bg-blue-50/50 dark:bg-blue-500/10' : 'bg-slate-50/50 dark:bg-darkBg/50'} flex justify-between items-center border-b border-slate-100 dark:border-slate-800">
                                <div>
                                    <h4 class="text-xl font-extrabold tracking-tight ${isTodayReal ? 'text-blue-600 dark:text-blue-400' : 'text-slate-800 dark:text-slate-200'}">
                                        ${tarihFormatla(date)}
                                    </h4>
                                    ${isTodayReal ? '<span class="text-[10px] uppercase font-bold tracking-wider text-blue-500 animate-pulse">Bug√ºn</span>' : ''}
                                </div>
                                <button onclick="copyDaySchedule('${dateStr}', ${lessonsData})" class="text-slate-500 dark:text-slate-400 bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 p-2 rounded-lg transition-colors" title="Kopyala">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                                    </svg>
                                </button>
                            </div>

                            <div class="p-4 pt-2 pb-5">
                                ${lessonHtml}
                            </div>
                        </div>
                    `;
                }
            }
        }

        const dersCedveliKurs1 = {
            "alt": { 1: ["1)IT …ôsaslarƒ± (seminar) - Kazƒ±mov Ramin", "2)Diferensial t…ônlikl…ôr (m√ºhazir…ô) - Eyyubov Ramazan", "3)Fizika (m√ºhazir…ô) - ∆èlizad…ô Leyla"], 2: ["1)X…ôtti c…ôbr (seminar) - S…ôm…ôdzad…ô F…ôrahim", "2)XDƒ∞AK-2 (seminar) - Abbasova Nurid…ô"], 3: ["2)XDƒ∞AK-2 (seminar) - Abbasova Nurid…ô", "3)IT …ôsaslarƒ±-2 (m√ºhazir…ô) - Kazƒ±mov Ramin"], 4: ["3)ƒ∞nstrumental proqramlar (seminar) - G√∂y√º≈ül√º R…ôvan…ô"], 5: ["2)Proqramla≈üdƒ±rma …ôsaslarƒ± (m√ºhazir…ô) - S…ônan Niyazi", "3)ƒ∞nstrumental proqramlar (m√ºhazir…ô) - G√∂y√º≈ül√º R…ôvan…ô"] },
            "ust": { 1: ["1)X…ôtti c…ôbr (m√ºhazir…ô) - S…ôm…ôdzad…ô F…ôrahim", "2)Diferensial t…ônlikl…ôr (m√ºhazir…ô) - Eyyubov Ramazan", "3)Fizika (m√ºhazir…ô) - ∆èlizad…ô Leyla"], 2: ["1)X…ôtti c…ôbr (seminar) - S…ôm…ôdzad…ô F…ôrahim", "2)XDƒ∞AK-2 (seminar) - Abbasova Nurid…ô", "3)Proqramla≈üdƒ±rma (seminar) - S…ônan Niyazi"], 3: ["2)XDƒ∞AK-2 (seminar) - Abbasova Nurid…ô", "3)ƒ∞T …ôsaslarƒ±-2 (m√ºhazir…ô) - Kazƒ±mov Ramin"], 4: ["2)Diferensial t…ônlikl…ôr (seminar) - Ramazan Eyyubov", "3)Fizika Seminar (seminar) - ∆èlizad…ô Leyla"], 5: ["2)Proqramla≈üdƒ±rma …ôsaslarƒ± (m√ºhazir…ô) - S…ônan Niyazi", "3)ƒ∞nstrumental proqramlar (m√ºhazir…ô) - G√∂y√º≈ül√º R…ôvan…ô"] }
        };

        window.dersleriGosterKurs1 = function () {
            let container = document.getElementById("schedule_kurs1");
            if (!container) return;
            container.innerHTML = "";
            const gunler = ["", "1-ci G√ºn", "2-ci G√ºn", "3-c√º G√ºn", "4-c√º G√ºn", "5-ci G√ºn"];

            const renderWeek = (weekType) => {
                const isAlt = weekType === 'alt';
                container.innerHTML += `
                <div class="flex flex-col items-center mt-8 mb-4">
                    <span class="text-3xl font-bold ${isAlt ? 'text-yellow-400' : 'text-green-400'} uppercase drop-shadow-sm">
                        ${isAlt ? 'ALT H∆èFT∆è' : '√úST H∆èFT∆è'}
                    </span>
                </div>`;

                for (let day = 1; day <= 5; day++) {
                    const lessons = dersCedveliKurs1[weekType][day];

                    if (lessons) {
                        const lessonHtml = lessons.map(l => {
                            let display = l;
                            let slotNum = null;
                            if (l.startsWith('{')) {
                                const endIdx = l.indexOf('}');
                                slotNum = parseInt(l.substring(1, endIdx));
                                display = l.substring(endIdx + 1).trim();
                            }

                            const hasLegacyNumbering = /^\d+\)/.test(display);
                            let numberPrefix = "";
                            if (!hasLegacyNumbering && slotNum) {
                                let mappedNum = (slotNum > 3) ? (slotNum - 3) : slotNum;
                                numberPrefix = `<span class="text-blue-400 font-bold mr-2 text-lg">${mappedNum}</span>`;
                            } else if (hasLegacyNumbering) {
                                const parts = display.match(/^(\d+\))(.*)/);
                                if (parts) {
                                    numberPrefix = `<span class="text-blue-400 font-bold mr-2 text-lg">${parts[1].replace(')', '')}</span>`;
                                    display = parts[2];
                                }
                            }

                            let typeBadge = "";
                            if (display.toLowerCase().includes("m√ºhazir…ô")) {
                                typeBadge = `<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-purple-100 dark:bg-purple-500/10 text-purple-600 dark:text-purple-400 border border-purple-200 dark:border-purple-500/20 uppercase tracking-wider ml-2">M√ºhazir…ô</span>`;
                                display = display.replace(/\(m√ºhazir…ô\)/i, '').trim();
                            } else if (display.toLowerCase().includes("seminar")) {
                                typeBadge = `<span class="px-2 py-0.5 rounded text-[10px] font-bold bg-orange-100 dark:bg-orange-500/10 text-orange-600 dark:text-orange-400 border border-orange-200 dark:border-orange-500/20 uppercase tracking-wider ml-2">Seminar</span>`;
                                display = display.replace(/\(seminar\)/i, '').trim();
                            }

                            let content = display;
                            if (display.includes(' - ')) {
                                const parts = display.split(' - ');
                                const subj = parts[0].trim();
                                const teach = parts.slice(1).join(' - ').trim();
                                content = `<span class="text-slate-900 dark:text-white font-bold text-base">${subj}</span>${typeBadge}<span class="block text-sm text-slate-500 dark:text-gray-400 mt-1 flex items-center gap-2"><div class="p-1 rounded-full bg-slate-200 dark:bg-slate-700"><svg class="w-3 h-3 text-slate-600 dark:text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg></div> <span class="text-slate-600 dark:text-slate-400 font-medium">${teach}</span></span>`;
                            } else {
                                content = `<span>${display}</span>${typeBadge}`;
                            }

                            return `<div class="relative p-3 rounded-2xl mt-3 text-sm flex items-start transition-all duration-300 overflow-hidden bg-slate-50 border border-slate-100 dark:border-none dark:bg-slate-800/50 hover:bg-slate-100 dark:hover:bg-slate-700/50">
                                            <div class="mt-0.5">${numberPrefix}</div>
                                            <div class="absolute left-0 top-3 bottom-3 w-1.5 bg-blue-500 rounded-r-lg"></div>
                                            <div class="w-full pl-4 py-1">${content}</div>
                                        </div>`;
                        }).join('');

                        container.innerHTML += `
                        <div class='relative group overflow-hidden transition-all duration-300 bg-white dark:bg-darkCard border border-slate-200 dark:border-slate-800 shadow-sm hover:shadow-md rounded-3xl mt-4'>
                            <div class="p-4 bg-slate-50/50 dark:bg-darkBg/50 flex justify-between items-center border-b border-slate-100 dark:border-slate-800">
                                <div>
                                    <h4 class="text-xl font-extrabold tracking-tight text-slate-800 dark:text-slate-200">
                                        ${gunler[day]}
                                    </h4>
                                </div>
                            </div>
                            <div class="p-4 pt-2 pb-5">
                                ${lessonHtml}
                            </div>
                        </div>`;
                    }
                }
            };
            renderWeek("alt");
            renderWeek("ust");
        }

        window.showSection = function (id) {
            document.querySelectorAll('.content').forEach(c => c.classList.add('hidden'));
            const el = document.getElementById(id);
            if (el) el.classList.remove('hidden');

            if (id === 'pdfsSection' && document.getElementById("pdf1") && !document.getElementById("pdf1").src) {
                document.getElementById("pdf1").src = "https://drive.google.com/file/d/1nis8yYs2h62nUswOa8qfGGlmHwZUZ0R2/preview";
                document.getElementById("pdf1-download").href = "https://drive.google.com/uc?export=download&id=1nis8yYs2h62nUswOa8qfGGlmHwZUZ0R2";
                document.getElementById("pdf2").src = "https://drive.google.com/file/d/16RVdE5pbYHQap9Em_sIZN2v8T0IJpT_e/preview";
                document.getElementById("pdf2-download").href = "https://drive.google.com/uc?export=download&id=16RVdE5pbYHQap9Em_sIZN2v8T0IJpT_e";
            } else if (id === 'flappySection' && !document.getElementById("flappyIframe")) {
                const f = document.createElement("iframe"); f.id = "flappyIframe"; f.src = "https://kenox7.github.io/FlappyRaminn/"; f.className = "w-full h-full border-none";
                document.getElementById("flappyContainer").appendChild(f);
            } else if (id === 'bagikSection' && !document.getElementById("bagikIframe")) {
                const b = document.createElement("iframe"); b.id = "bagikIframe"; b.src = "https://kenox7.github.io/BagikRun/"; b.className = "w-full h-full border-none";
                document.getElementById("bagikContainer").appendChild(b);
            } else if (id === 'kurs1Section') {
                dersleriGosterKurs1();
            }
        };

        // --- PWA Logic (YENƒ∞L∆èNMƒ∞≈û V2) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => console.log('ServiceWorker registration successful'))
                    .catch(err => console.log('ServiceWorker registration failed: ', err));
            });
        }

        let deferredPrompt;
        const installContainer = document.getElementById('pwa-install-container');
        const installBtn = document.getElementById('pwa-install-btn');
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.matchMedia('(display-mode: standalone)').matches;

        // Android/Desktop: Wait for event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later.
            deferredPrompt = e;
            // Update UI to notify the user they can add to home screen
            if (installContainer) installContainer.classList.remove('hidden');
            console.log("Install prompt captured");
        });

        // iOS: Show immediately if not installed (since event doesn't fire)
        if (isIOS && !isStandalone) {
            if (installContainer) installContainer.classList.remove('hidden');
        }

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to the install prompt: ${outcome}`);
                    if (outcome === 'accepted') {
                        installContainer.classList.add('hidden');
                    }
                    deferredPrompt = null;
                } else if (isIOS) {
                    showIOSInstruction();
                } else {
                    // Fallback
                    alert("T…ôtbiqi qura≈üdƒ±rmaq √º√ß√ºn brauzer menyusundan 'T…ôtbiqi Qura≈üdƒ±r' se√ßin.\n(Qeyd: ∆èg…ôr bu mesajƒ± g√∂r√ºrs√ºn√ºzs…ô, brauzerinizd…ô 'favicon.png' ikonu v…ô ya HTTPS baƒülantƒ±sƒ± yoxdur.)");
                }
            });
        }

        function showIOSInstruction() {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black/80 z-[60] flex flex-col justify-end pb-10 items-center text-center p-4 animate-fade-in';
            // Arrow pointing down
            modal.innerHTML = `
                <div class="bg-gray-800 rounded-xl p-6 max-w-sm mb-4 border border-gray-700 shadow-2xl relative w-full mx-4">
                    <button onclick="this.parentElement.parentElement.remove()" class="absolute top-2 right-2 text-slate-500 dark:text-gray-400 hover:text-white">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <h3 class="text-lg font-bold text-white mb-4">iOS-da Y√ºkl…ôm…ôk √ú√ß√ºn:</h3>
                    <div class="space-y-4 text-left text-sm text-slate-700 dark:text-slate-300">
                        <div class="flex items-start gap-3">
                            <span class="bg-gray-700 min-w-6 h-6 flex items-center justify-center rounded-full text-blue-400 font-bold">1</span>
                            <span>A≈üaƒüƒ±dakƒ± m…ôrk…ôzi <strong class="text-white">Payla≈ü</strong> (<svg class="w-4 h-4 inline-block -mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path></svg>) d√ºym…ôsin…ô basƒ±n.</span>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="bg-gray-700 min-w-6 h-6 flex items-center justify-center rounded-full text-blue-400 font-bold">2</span>
                            <span>Menyunu a≈üaƒüƒ± s√ºr√º≈üd√ºr√ºn v…ô <strong class="text-white">"Ana Ekrana ∆èlav…ô Et"</strong> (<span class="text-slate-500 dark:text-gray-400">Add to Home Screen</span>) se√ßin.</span>
                        </div>
                         <div class="flex items-start gap-3">
                            <span class="bg-gray-700 min-w-6 h-6 flex items-center justify-center rounded-full text-blue-400 font-bold">3</span>
                             <span>Saƒü yuxarƒ± k√ºncd…ô <strong class="text-white">"∆èlav…ô et"</strong> (Add) d√ºym…ôsin…ô basƒ±n.</span>
                        </div>
                    </div>
                </div>
                <div class="text-white animate-bounce pointer-events-none">
                    <svg class="w-10 h-10 mx-auto drop-shadow-lg" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg>
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            init();
        });
    </script>
</body>

</html>
